<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.linkee.linkeeapi.room_member.query.mapper.RoomMemberMapper">

    <!-- 퀴즈방 멤버 목록 조회 -->
    <select id="selectAllRoomMember" resultType="com.linkee.linkeeapi.room_member.query.dto.response.RoomMemberResponse">
        SELECT
            room_member_id AS roomMemberId,
            member_id AS memberId,
            quiz_room_id AS quizRoomId,
            is_ready AS isReady,
            is_victory AS isVictory,
            joined_at AS joinedAt,
            lefted_at AS leftedAt
        FROM tb_room_member
        WHERE 1=1
        AND lefted_at IS NULL -- 방을 나가지 않은 멤버만
        <if test="quizRoomId != null and quizRoomId != ''">
            AND quiz_room_id = #{quizRoomId}
        </if>
        ORDER BY joined_at ASC -- 들어온 순서대로 정렬 (오름차순)
    </select>

</mapper>